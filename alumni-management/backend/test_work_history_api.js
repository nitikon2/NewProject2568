// ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà
const axios = require('axios');

async function testWorkHistoryAPI() {
    const baseURL = 'http://localhost:5000/api';
    
    // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö
    const testData = {
        company_name: '‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡πÄ‡∏ó‡∏™‡∏ï‡πå ‡∏à‡∏≥‡∏Å‡∏±‡∏î',
        company_type: 'private',
        industry: '‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ',
        company_size: 'medium',
        position: '‡∏ô‡∏±‡∏Å‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå',
        department: 'IT',
        job_level: 'senior',
        job_description: '‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
        start_date: '2023-01-01',
        end_date: null,
        is_current: true,
        employment_type: 'full_time',
        salary_range: '30,000 - 40,000 ‡∏ö‡∏≤‡∏ó',
        location: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÄ‡∏ó‡∏™ ‡∏ä‡∏±‡πâ‡∏ô 10',
        work_province: '‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£',
        work_district: '‡∏ß‡∏±‡∏í‡∏ô‡∏≤',
        work_subdistrict: '‡∏•‡∏∏‡∏°‡∏û‡∏¥‡∏ô‡∏µ',
        work_zipcode: '10330',
        skills_used: 'JavaScript, React, Node.js, MySQL',
        technologies_used: 'React, Express, MySQL, Git',
        key_achievements: '‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà',
        team_size: '5'
    };

    try {
        console.log('üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà...\n');

        // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ token ‡∏Ç‡∏≠‡∏á admin (‡∏´‡∏£‡∏∑‡∏≠ user ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß)
        const loginResponse = await axios.post(`${baseURL}/auth/login`, {
            email: 'admin@rmu.ac.th',
            password: 'admin123456'
        });

        const token = loginResponse.data.token;
        console.log('‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');

        // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        const response = await axios.post(`${baseURL}/work-history`, testData, {
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });

        console.log('‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        console.log('üìã Response:', response.data);

        const workHistoryId = response.data.data.id;

        // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        const getResponse = await axios.get(`${baseURL}/work-history`, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        console.log('\n‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        const addedWork = getResponse.data.data.find(work => work.id === workHistoryId);
        
        if (addedWork) {
            console.log('üìÑ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:');
            console.log(`  ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î: ${addedWork.work_province}`);
            console.log(`  ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠: ${addedWork.work_district}`);
            console.log(`  ‡∏ï‡∏≥‡∏ö‡∏•: ${addedWork.work_subdistrict}`);
            console.log(`  ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå: ${addedWork.work_zipcode}`);
        }

        // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        const updateData = {
            ...testData,
            work_subdistrict: '‡∏™‡∏µ‡∏•‡∏°',
            work_zipcode: '10500'
        };

        const updateResponse = await axios.put(`${baseURL}/work-history/${workHistoryId}`, updateData, {
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });

        console.log('\n‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        console.log('üìã Update Response:', updateResponse.data);

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
        const getUpdatedResponse = await axios.get(`${baseURL}/work-history`, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        const updatedWork = getUpdatedResponse.data.data.find(work => work.id === workHistoryId);
        
        if (updatedWork) {
            console.log('\nüìÑ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï:');
            console.log(`  ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î: ${updatedWork.work_province}`);
            console.log(`  ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠: ${updatedWork.work_district}`);
            console.log(`  ‡∏ï‡∏≥‡∏ö‡∏•: ${updatedWork.work_subdistrict}`);
            console.log(`  ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå: ${updatedWork.work_zipcode}`);
        }

        // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö
        await axios.delete(`${baseURL}/work-history/${workHistoryId}`, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        console.log('\nüóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß');
        console.log('\nüéâ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö API ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥!');

    } catch (error) {
        console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:', error.response?.data || error.message);
        
        if (error.response?.status === 401) {
            console.error('üîê ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö token');
        } else if (error.response?.status === 400) {
            console.error('üìù ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á:', error.response.data);
        } else if (error.response?.status === 500) {
            console.error('üñ•Ô∏è ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå');
        }
    }
}

// ‡∏£‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö
if (require.main === module) {
    testWorkHistoryAPI();
}

module.exports = testWorkHistoryAPI;